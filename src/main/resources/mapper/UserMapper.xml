<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fontal.fonpicturebackend.mapper.UserMapper">

    <!-- 结果映射 -->
    <resultMap id="BaseResultMap" type="com.fontal.fonpicturebackend.model.domain.User">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="userName" property="userName" jdbcType="VARCHAR"/>
        <result column="email" property="email" jdbcType="VARCHAR"/>
        <result column="userPassword" property="userPassword" jdbcType="VARCHAR"/>
        <result column="userAvatar" property="userAvatar" jdbcType="VARCHAR"/>
        <result column="userRole" property="userRole" jdbcType="VARCHAR"/>
        <result column="userProfile" property="userProfile" jdbcType="VARCHAR"/>
        <result column="provider" property="provider" jdbcType="VARCHAR"/>
        <result column="providerId" property="providerId" jdbcType="VARCHAR"/>
        <result column="thirdPartyAvatar" property="thirdPartyAvatar" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="TINYINT"/>
        <result column="lastLoginTime" property="lastLoginTime" jdbcType="TIMESTAMP"/>
        <result column="lastLoginIp" property="lastLoginIp" jdbcType="VARCHAR"/>
        <result column="createTime" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="updateTime" property="updateTime" jdbcType="TIMESTAMP"/>
        <result column="isDelete" property="isDelete" jdbcType="TINYINT"/>
    </resultMap>

    <!-- 基础字段 -->
    <sql id="Base_Column_List">
        id, userName, email, userPassword, userAvatar, userRole, userProfile,
        provider, providerId, thirdPartyAvatar, status, lastLoginTime, lastLoginIp,
        createTime, updateTime, isDelete, deleteTime
    </sql>

    <!-- 根据用户名查询用户列表（模糊查询） -->
    <select id="getUserByUserName" resultMap="BaseResultMap" parameterType="java.lang.String">
        SELECT
        <include refid="Base_Column_List"/>
        FROM user
        WHERE userName LIKE CONCAT('%', #{userName,jdbcType=VARCHAR}, '%')
        AND isDelete = 0
    </select>

    <!-- 根据邮箱查询用户 -->
    <select id="getUserByEmail" resultMap="BaseResultMap" parameterType="java.lang.String">
        SELECT
        <include refid="Base_Column_List"/>
        FROM user
        WHERE email = #{email,jdbcType=VARCHAR}
        AND isDelete = 0
    </select>

    <!-- 根据用户角色查询用户列表 -->
    <select id="getUserByRole" resultMap="BaseResultMap" parameterType="java.lang.String">
        SELECT
        <include refid="Base_Column_List"/>
        FROM user
        WHERE userRole = #{userRole,jdbcType=VARCHAR}
        AND isDelete = 0
        ORDER BY createTime DESC
    </select>

    <!-- 统计用户数量 -->
    <select id="countUsers" resultType="java.lang.Long">
        SELECT COUNT(*)
        FROM user
        WHERE isDelete = 0
    </select>

</mapper>
